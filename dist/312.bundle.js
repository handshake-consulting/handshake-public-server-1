"use strict";(self.webpackChunkask_give_org_chatbot_package=self.webpackChunkask_give_org_chatbot_package||[]).push([[312],{312:(e,t,n)=>{n.r(t),n.d(t,{default:()=>c,loadDataFromSession:()=>f});var s=n(818),o=n(413);let a=new AbortController,r="";async function c(){(0,o.UK)("full"),(0,o.mp)("username")||((0,o.B3)("username"),(0,o.B3)("chat_session"));document.getElementById("gb-current-year").textContent=(new Date).getFullYear()+"Â©";const e=document.getElementById("gb-form"),t=document.getElementById("gb-submit-btn"),n=e.querySelector('textarea[name="chat"]');t.addEventListener("click",(async e=>{e.preventDefault();const s=n.value;t.disabled=!0,n.disabled=!0,await d(s),n.value="",t.disabled=!1,n.disabled=!1}));document.getElementById("gb-resetchat").onclick=e=>{e.preventDefault(),l()},f(),(0,o.m4)()}const d=async(e,t,n)=>{if(a=new AbortController,0===e.trim().length)return void alert("Please enter a message");(0,o.Ep)("gb-chatbot-scrolldown"),m(!0);const c=Date.now().toString();try{const d=await fetch("retry"===t?s.T+"/retry":s.T+"/submit",{method:"POST",body:JSON.stringify({message:e.trim(),chat_session:(0,o.mp)("chat_session"),username:(0,o.mp)("username"),next_message:"retry"===t?n:r}),headers:{"Content-Type":"application/json"},signal:a.signal});if(!d.ok){const e=await d.text();throw new Error(e)}const l=d.body;if(!l)return;const p=l.pipeThrough(new TextDecoderStream).getReader();let h="";g(e,c),b(h,c);let f=document.getElementById("botFlex-1-"+c);for(u(f,c),(0,o.oB)(`user_message_${c}`,e);;){const{value:t,done:n}=await p.read();if(n){const t=document.createElement("div");t.id="botRef-1-"+c,t.className="gb-mt-2 gb-px-4 gb-flex gb-flex-wrap gb-gap-1",f.appendChild(t),await i(e,c),m(!1);break}h+=t;let s=document.getElementById(c);s.innerHTML=window.marked.parse(h),f.appendChild(s),document.getElementById("gb-chatbot-scrolldown").scrollIntoView({behavior:"smooth",block:"end"}),(0,o.oB)(`bot_response_${c}`,h)}}catch(e){"AbortError"===e.name||console.error("Error:",e),m(!1)}},i=async(e,t)=>{try{const n=await fetch(s.T+"/content",{method:"POST",body:JSON.stringify({message:e,chat_session:(0,o.mp)("chat_session"),username:(0,o.mp)("username"),next_message:r}),headers:{"Content-Type":"application/json",accept:"application/json"}}),a=await n.json(),c=await JSON.parse(a);if(""!==c.output){r=c.next_node;const e=c.queries;if((0,o.oB)(`next_message_${t}`,r),0===Object.keys(e).length||0===e.url.length)throw new Error("No data available");const n=e.url.map((async(n,s)=>(p(t,{id:t,title:e.title[s],content:e.content[s],date:e.date[s],url:e.url[s]}),{id:t,title:e.title[s],content:e.content[s],date:e.date[s],url:e.url[s]})));(0,o.oB)(`reference_data_${t}`,JSON.stringify(n))}}catch(e){console.error("Error:",e)}finally{h(t)}},l=()=>{(0,o.B3)("chat_session"),document.getElementById("gb-chatbody").innerHTML="",r=null;Object.keys(sessionStorage).filter((e=>e.startsWith("user_message_"))).forEach((e=>{sessionStorage.removeItem(e)}));Object.keys(sessionStorage).filter((e=>e.startsWith("next_message_"))).forEach((e=>{sessionStorage.removeItem(e)}));Object.keys(sessionStorage).filter((e=>e.startsWith("bot_response_"))).forEach((e=>{sessionStorage.removeItem(e)}));Object.keys(sessionStorage).filter((e=>e.startsWith("reference_data_"))).forEach((e=>{sessionStorage.removeItem(e)})),location.reload()};function m(e){const t=document.getElementById("gb-chatbot-loader"),n=document.getElementById("gb-submit-icon"),s=document.getElementById("gb-submit-loading");e?(t.classList.remove("gb-hidden"),n.classList.add("gb-hidden"),s.classList.remove("gb-hidden")):(t.classList.add("gb-hidden"),n.classList.remove("gb-hidden"),s.classList.add("gb-hidden"))}function g(e,t){const n=document.getElementById("gb-chatbody"),s=document.createElement("div");s.className="gb-flex gb-flex-row-reverse  gb-my-4",s.id="gb-user-"+t;const o=document.createElement("p");o.className="gb-p-4 gb-bg-reply-gradient gb-text-white gb-rounded ",o.textContent=e,s.appendChild(o),n.appendChild(s)}function b(e,t){const n=document.getElementById("gb-chatbody"),s=document.createElement("div");s.className="gb-mt-5  gb-flex gb-flex-col  md:gb-flex-row gb-items-start gb-space-x-3",s.id="gb-bot-"+t;const o=document.createElement("img");o.src="/sf-images/default-source/giving-coach-ai/giveorgbfeacd32d46e4cb6884e4af525762179.png?Status=Master&sfvrsn=218481fd_2",o.className="gb-w-[59.47px]  gb-rounded-[10px]",s.appendChild(o);const a=document.createElement("div");a.id="botFlex-1-"+t,a.className="gb-bg-[#D9EBF1] gb-rounded ",s.appendChild(a),n.appendChild(s)}function u(e,t){const n=document.createElement("p");n.className="gb-p-4  gb-my-5 gb-rounded gb-whitespace-pre-wrap",n.id=t,e.appendChild(n)}function p(e,t){const n=document.getElementById("botRef-1-"+e),s=document.createElement("a");s.href=t.url,s.target="_blank";const o=document.createElement("span");o.className="gb-bg-[#FFD368] gb-space-x-2 gb-no-underline gb-hover:underline gb-text-xs gb-font-medium gb-inline-flex gb-items-center gb-px-2.5 gb-py-0.5 gb-rounded-lg";const a=document.createElement("img");a.src="/sf-images/default-source/giving-coach-ai/book.png?Status=Temp&sfvrsn=5dc9ba90_2",a.width=17,a.height=16,o.appendChild(a);const r=document.createElement("p");r.textContent=t.title,r.className="hover:gb-underline gb-m-0 gb-text-black",o.appendChild(r),s.appendChild(o),n.appendChild(s)}function h(e){const t=document.getElementById("botFlex-1-"+e),n=document.createElement("div");n.className="gb-px-4 gb-my-2 gb-pb-3",n.id="gb-message-actions-1"+e;const s=document.createElement("button");s.className="hover:gb-bg-[#E4E4E4] gb-p-2.5 gb-rounded-full";const a=document.createElement("img");a.src="/sf-images/default-source/giving-coach-ai/reload.png?Status=Temp&sfvrsn=37de681e_2",a.alt="Reload",a.title="Reload",s.appendChild(a),s.id="gb-message-actions-2-"+e,s.addEventListener("click",(()=>async function(e){try{const t=(0,o.mp)(`user_message_${e}`),n=(0,o.mp)(`next_message_${e}`),s=Array.from(document.querySelectorAll('[id^="gb-user-"]')).findIndex((t=>t.id===`gb-user-${e}`));Array.from(document.querySelectorAll('[id^="gb-user-"]')).slice(s).forEach((e=>e.remove()));Array.from(document.querySelectorAll('[id^="gb-bot-"]')).slice(s).forEach((e=>e.remove()));Object.keys(sessionStorage).filter((t=>t.startsWith("user_message_")&&parseInt(t.split("_")[2])>=e)).forEach((e=>sessionStorage.removeItem(e)));Object.keys(sessionStorage).filter((t=>t.startsWith("bot_response_")&&parseInt(t.split("_")[2])>=e)).forEach((e=>sessionStorage.removeItem(e)));Object.keys(sessionStorage).filter((t=>t.startsWith("reference_data_")&&parseInt(t.split("_")[2])>=e)).forEach((e=>sessionStorage.removeItem(e))),await d(t,"retry",n)}catch(e){console.error("Error during retry:",e)}}(e))),n.appendChild(s);const r=document.createElement("button");r.className="hover:gb-bg-[#E4E4E4] gb-p-2.5 gb-rounded-full";const c=document.createElement("img");c.title="Report",c.alt="Report",c.src="/sf-images/default-source/giving-coach-ai/report.png?Status=Temp&sfvrsn=ad5a1c9f_2",r.appendChild(c),r.id="gb-message-actions-2"+e,r.addEventListener("click",(()=>function(e){const t=document.getElementById("reportModal");t.classList.remove("gb-hidden"),t.setAttribute("data-message-id",e)}(e))),n.appendChild(r),t.appendChild(n)}function f(){const e=document.getElementById("gb-chatbody");Object.keys(sessionStorage).filter((e=>e.startsWith("user_message_"))).sort(((e,t)=>parseInt(e.split("_")[2])-parseInt(t.split("_")[2]))).forEach((e=>{const t=e.split("_")[2];g((0,o.mp)(e),t);const n=`bot_response_${t}`;if(sessionStorage.hasOwnProperty(n)){const e=(0,o.mp)(n);b(0,t);const s=document.getElementById("botFlex-1-"+t);u(s,t);let a=document.getElementById(t);a.innerHTML=window.marked.parse(e),s.appendChild(a),document.getElementById("gb-chatbot-scrolldown").scrollIntoView({behavior:"smooth",block:"end"});const r=document.createElement("div");r.id="botRef-1-"+t,r.className="gb-mt-2 gb-px-4 gb-flex gb-flex-wrap gb-gap-1",s.appendChild(r);const c=`reference_data_${t}`;if(sessionStorage.hasOwnProperty(c)){JSON.parse((0,o.mp)(c)).forEach((e=>{p(t,e)})),h(t)}}})),e.scrollTop=e.scrollHeight}document.getElementById("closeModal").addEventListener("click",y);function y(){document.getElementById("reportModal").classList.add("gb-hidden")}document.getElementById("closeButton").addEventListener("click",y);document.getElementById("gb-reportmodal-submit").addEventListener("click",(async function(e){e.preventDefault();const t=document.getElementById("reportModal").getAttribute("data-message-id"),n=document.getElementById("gb-reportmodal-submit"),a=(0,o.mp)(`user_message_${t}`),r=(0,o.mp)(`bot_response_${t}`),c=(0,o.mp)(`next_message_${t}`),d=document.querySelector('#reportModal textarea[name="feedback"]').value;if(0===d.trim().length)return void alert("Please enter a feedback");const i=n;i.disabled=!0,i.textContent="Submitting...";try{const e=await fetch(s.T+"/response",{method:"POST",body:JSON.stringify({username:(0,o.mp)("username"),message:a,chat_response:r,chat_session:(0,o.mp)("chat_session"),next_message:c,feedback:d}),headers:{"Content-Type":"application/json"}});e.ok?(alert("Report submitted successfully"),y()):console.error("Error submitting report:",e.statusText)}catch(e){console.error("Error submitting report:",e)}finally{i.disabled=!1,i.textContent="Submit"}}));const E=document.querySelector('[data-page="fullscreen"]'),_=document.getElementById("faq"),v=document.getElementById("faqButton"),x=document.getElementById("fullscreenButton");function w(){E.classList.add("gb-transform","-gb-translate-x-full","gb-transition-transform","gb-duration-500","gb-ease-in-out"),_.classList.remove("gb-hidden"),_.classList.add("gb-transform","gb-translate-x-0","gb-transition-transform","gb-duration-500","gb-ease-in-out")}function I(){_.classList.add("gb-transform","gb-transition-transform","gb-duration-500","gb-ease-in-out"),setTimeout((()=>{_.classList.add("gb-hidden"),E.classList.remove("gb-transform","-gb-translate-x-full")}),500)}v.addEventListener("click",w),x.addEventListener("click",I),"#faq"===window.location.hash&&w(),window.addEventListener("hashchange",(()=>{"#faq"===window.location.hash?w():I()}))}}]);
//# sourceMappingURL=312.bundle.js.map