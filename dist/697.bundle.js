"use strict";(self.webpackChunkask_give_org_chatbot_package=self.webpackChunkask_give_org_chatbot_package||[]).push([[697],{697:(e,t,s)=>{s.r(t),s.d(t,{default:()=>c,makeRequest:()=>d});var o=s(818),n=s(413);let a=new AbortController,r="",i="gb-mobile";function c(){(0,n.mp)("username")||((0,n.B3)("username"),(0,n.B3)("chat_session")),(0,n.JK)(),window.addEventListener("load",l),(0,n.ob)()}function l(){(0,n.b0)(i);const e=document.getElementById("gb-form-"+i),t=document.getElementById("gb-submit-btn-"+i),s=e.querySelector('textarea[name="chat"]');t.addEventListener("click",(async e=>{e.preventDefault();const o=s.value;t.disabled=!0,s.disabled=!0,await d(o),s.value="",t.disabled=!1,s.disabled=!1})),(0,n.UK)(i);document.getElementById("gb-resetchat-"+i).onclick=e=>{e.preventDefault(),g()}}const d=async(e,t,s)=>{if(a=new AbortController,0===e.trim().length)return void alert("Please enter a message");b(!0,i),document.getElementById("gb-chatbot-scrolldown-"+i).scrollIntoView({behavior:"smooth",block:"end"});const c=Date.now().toString();try{const l=await fetch("retry"===t?o.T+"/retry":o.T+"/submit",{method:"POST",body:JSON.stringify({message:e,chat_session:(0,n.mp)("chat_session"),username:(0,n.mp)("username"),next_message:"retry"===t?s:r}),headers:{"Content-Type":"application/json"},signal:a.signal});if(!l.ok){const e=await l.text();throw new Error(e)}const d=l.body;if(!d)return;const g=d.pipeThrough(new TextDecoderStream).getReader();let u="";(0,n.J2)(e,c,i),(0,n.vp)(u,c,i);let h=document.getElementById("botFlex-1-"+c+"-"+i);for((0,n.tC)(h,c,i),(0,n.oB)(`user_message_${c}`,e);;){const{value:t,done:s}=await g.read();if(s){const t=document.createElement("div");t.className="gb-mt-2 gb-px-4 gb-flex gb-flex-col gb-space-y-3 gb-bot-references",t.id="botRef-1-"+c+"-"+i,h.appendChild(t),await m(e,c),b(!1,i);break}u+=t;let o=document.getElementById(c+"-"+i);o.innerHTML=window.marked.parse(u),h.appendChild(o),document.getElementById("gb-chatbot-scrolldown-"+i).scrollIntoView({behavior:"smooth",block:"end"}),(0,n.oB)(`bot_response_${c}`,u)}}catch(e){console.log("Error:",e),"AbortError"===e.name?b(!1,i):(b(!1,i),console.error("Error:",e))}},m=async(e,t)=>{try{const s=await fetch(o.T+"/content",{method:"POST",body:JSON.stringify({message:e,chat_session:(0,n.mp)("chat_session"),username:(0,n.mp)("username"),next_message:r}),headers:{"Content-Type":"application/json",accept:"application/json"}}),a=await s.json(),c=await JSON.parse(a);if(""!==c.output){r=c.next_node;const e=c.queries;if((0,n.oB)(`next_message_${t}`,r),0===Object.keys(e).length||0===e.url.length)throw new Error("No data available");const s=e.url.map(((s,o)=>((0,n.D8)(t,{id:t,title:e.title[o],content:e.content[o],date:e.date[o],url:e.url[o]},i),{id:t,title:e.title[o],content:e.content[o],date:e.date[o],url:e.url[o]})));(0,n.oB)(`reference_data_${t}`,JSON.stringify(s))}}catch(e){console.error("Error:",e)}finally{(0,n.xd)(t,i)}},g=()=>{(0,n.B3)("chat_session"),document.getElementById(i).innerHTML="",r=null;Object.keys(sessionStorage).filter((e=>e.startsWith("user_message_"))).forEach((e=>{sessionStorage.removeItem(e)}));Object.keys(sessionStorage).filter((e=>e.startsWith("next_message_"))).forEach((e=>{sessionStorage.removeItem(e)}));Object.keys(sessionStorage).filter((e=>e.startsWith("bot_response_"))).forEach((e=>{sessionStorage.removeItem(e)}));Object.keys(sessionStorage).filter((e=>e.startsWith("reference_data_"))).forEach((e=>{sessionStorage.removeItem(e)})),location.reload()};function b(e,t){const s=document.getElementById("gb-chatbot-loader-"+t),o=document.getElementById("gb-submit-icon-"+t),n=document.getElementById("gb-submit-loading-"+t);e?(s.classList.remove("gb-hidden"),o.classList.add("gb-hidden"),n.classList.remove("gb-hidden")):(s.classList.add("gb-hidden"),o.classList.remove("gb-hidden"),n.classList.add("gb-hidden"))}}}]);
//# sourceMappingURL=697.bundle.js.map